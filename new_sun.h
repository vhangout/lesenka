#include <avr/pgmspace.h>
#ifndef sunrise_shift
  #define sunrise_shift 0
#endif

#ifndef sunset_shift
  #define sunset_shift 0
#endif

const uint16_t _day_month[12] PROGMEM = { 0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334 };

const uint16_t _sun_time[365][2] PROGMEM = {
{556, 1008},
{555, 1009},
{555, 1011},
{555, 1012},
{555, 1013},
{554, 1014},
{554, 1016},
{553, 1017},
{553, 1018},
{552, 1020},
{551, 1021},
{551, 1023},
{550, 1024},
{549, 1026},
{548, 1028},
{547, 1029},
{546, 1031},
{545, 1033},
{544, 1035},
{543, 1036},
{541, 1038},
{540, 1040},
{539, 1042},
{537, 1044},
{536, 1046},
{534, 1047},
{533, 1049},
{531, 1051},
{530, 1053},
{528, 1055},
{527, 1057},
{525, 1059},
{523, 1061},
{521, 1063},
{519, 1065},
{518, 1067},
{516, 1069},
{514, 1071},
{512, 1074},
{510, 1076},
{508, 1078},
{506, 1080},
{504, 1082},
{502, 1084},
{499, 1086},
{497, 1088},
{495, 1090},
{493, 1092},
{491, 1094},
{488, 1096},
{486, 1099},
{484, 1101},
{481, 1103},
{479, 1105},
{477, 1107},
{474, 1109},
{472, 1111},
{469, 1113},
{467, 1115},
{464, 1118},
{462, 1120},
{459, 1122},
{457, 1124},
{454, 1126},
{452, 1128},
{449, 1130},
{447, 1132},
{444, 1134},
{441, 1136},
{439, 1139},
{436, 1141},
{433, 1143},
{431, 1145},
{428, 1147},
{425, 1149},
{423, 1151},
{420, 1153},
{417, 1156},
{415, 1158},
{412, 1160},
{409, 1162},
{406, 1164},
{404, 1166},
{401, 1168},
{398, 1171},
{395, 1173},
{393, 1175},
{390, 1177},
{387, 1179},
{384, 1181},
{381, 1184},
{379, 1186},
{376, 1188},
{373, 1190},
{370, 1192},
{367, 1195},
{365, 1197},
{362, 1199},
{359, 1201},
{356, 1204},
{353, 1206},
{351, 1208},
{348, 1211},
{345, 1213},
{342, 1215},
{339, 1217},
{337, 1220},
{334, 1222},
{331, 1224},
{328, 1227},
{325, 1229},
{323, 1231},
{320, 1234},
{317, 1236},
{314, 1239},
{312, 1241},
{309, 1243},
{306, 1246},
{304, 1248},
{301, 1251},
{298, 1253},
{296, 1255},
{293, 1258},
{290, 1260},
{288, 1263},
{285, 1265},
{282, 1268},
{280, 1270},
{277, 1272},
{275, 1275},
{272, 1277},
{270, 1280},
{267, 1282},
{265, 1285},
{263, 1287},
{260, 1289},
{258, 1292},
{256, 1294},
{253, 1297},
{251, 1299},
{249, 1301},
{247, 1303},
{245, 1306},
{242, 1308},
{240, 1310},
{238, 1312},
{236, 1315},
{235, 1317},
{233, 1319},
{231, 1321},
{229, 1323},
{228, 1325},
{226, 1327},
{225, 1328},
{223, 1330},
{222, 1332},
{220, 1334},
{219, 1335},
{218, 1337},
{217, 1338},
{216, 1340},
{215, 1341},
{214, 1342},
{214, 1343},
{213, 1344},
{213, 1345},
{212, 1346},
{212, 1347},
{212, 1347},
{211, 1348},
{211, 1348},
{212, 1349},
{212, 1349},
{212, 1349},
{212, 1349},
{213, 1349},
{214, 1349},
{214, 1348},
{215, 1348},
{216, 1348},
{217, 1347},
{218, 1346},
{219, 1345},
{220, 1345},
{222, 1344},
{223, 1343},
{225, 1341},
{226, 1340},
{228, 1339},
{229, 1338},
{231, 1336},
{233, 1335},
{235, 1333},
{237, 1331},
{239, 1330},
{241, 1328},
{243, 1326},
{245, 1324},
{247, 1322},
{249, 1320},
{251, 1318},
{253, 1316},
{256, 1314},
{258, 1312},
{260, 1310},
{262, 1307},
{265, 1305},
{267, 1303},
{269, 1301},
{272, 1298},
{274, 1296},
{276, 1293},
{279, 1291},
{281, 1288},
{283, 1286},
{286, 1283},
{288, 1281},
{290, 1278},
{293, 1276},
{295, 1273},
{298, 1270},
{300, 1268},
{302, 1265},
{305, 1262},
{307, 1260},
{309, 1257},
{312, 1254},
{314, 1252},
{316, 1249},
{319, 1246},
{321, 1243},
{323, 1241},
{326, 1238},
{328, 1235},
{330, 1232},
{332, 1229},
{335, 1227},
{337, 1224},
{339, 1221},
{341, 1218},
{344, 1215},
{346, 1213},
{348, 1210},
{350, 1207},
{352, 1204},
{355, 1201},
{357, 1198},
{359, 1196},
{361, 1193},
{363, 1190},
{365, 1187},
{367, 1184},
{370, 1182},
{372, 1179},
{374, 1176},
{376, 1173},
{378, 1170},
{380, 1167},
{382, 1165},
{384, 1162},
{386, 1159},
{388, 1156},
{390, 1154},
{393, 1151},
{395, 1148},
{397, 1145},
{399, 1143},
{401, 1140},
{403, 1137},
{405, 1134},
{407, 1132},
{409, 1129},
{411, 1126},
{413, 1124},
{415, 1121},
{417, 1118},
{419, 1116},
{421, 1113},
{423, 1110},
{425, 1108},
{427, 1105},
{429, 1103},
{431, 1100},
{433, 1097},
{435, 1095},
{437, 1092},
{439, 1090},
{441, 1087},
{443, 1085},
{445, 1082},
{447, 1080},
{449, 1078},
{451, 1075},
{453, 1073},
{456, 1070},
{458, 1068},
{460, 1066},
{462, 1064},
{464, 1061},
{466, 1059},
{468, 1057},
{470, 1055},
{472, 1053},
{474, 1050},
{476, 1048},
{478, 1046},
{480, 1044},
{482, 1042},
{484, 1040},
{486, 1038},
{488, 1036},
{490, 1035},
{492, 1033},
{494, 1031},
{496, 1029},
{498, 1028},
{500, 1026},
{501, 1024},
{503, 1023},
{505, 1021},
{507, 1020},
{509, 1018},
{511, 1017},
{513, 1015},
{515, 1014},
{516, 1013},
{518, 1011},
{520, 1010},
{522, 1009},
{523, 1008},
{525, 1007},
{527, 1006},
{528, 1005},
{530, 1004},
{531, 1003},
{533, 1003},
{534, 1002},
{536, 1001},
{537, 1001},
{538, 1000},
{540, 1000},
{541, 999},
{542, 999},
{543, 999},
{545, 998},
{546, 998},
{547, 998},
{548, 998},
{549, 998},
{549, 998},
{550, 998},
{551, 999},
{552, 999},
{552, 999},
{553, 1000},
{554, 1000},
{554, 1001},
{554, 1001},
{555, 1002},
{555, 1003},
{555, 1003},
{555, 1004},
{556, 1005},
{556, 1006},
{556, 1007}
};

int16_t _day_to_index(uint8_t day, uint8_t month) {
	return pgm_read_word(&_day_month[month]) + day;
}

bool is_night(uint8_t day, uint8_t month, uint8_t hour, uint8_t minutes) {
    unsigned int time = hour * 60 + minutes;
    int day_index = _day_to_index(day, month);
    return time < (pgm_read_word(&_sun_time[day_index][0]) + 60) || time > (pgm_read_word(&_sun_time[day_index][1]) - 60);
}

